<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion</title>
  <link rel="stylesheet" href="style.css">
</head>
<!-- Firebase SDKs -->
<script type="module">
  // Import via CDN les SDK n√©cessaires
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // Ton config Firebase (copie depuis ton projet Firebase)
const firebaseConfig = {
  apiKey: "AIzaSyDed2-9Ehd456Tp0bxR9DqHInD7JfGsZis",
  authDomain: "projet-z-66d5b.firebaseapp.com",
  databaseURL: "https://projet-z-66d5b-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "projet-z-66d5b",
  storageBucket: "projet-z-66d5b.firebasestorage.app",
  messagingSenderId: "997922014696",
  appId: "1:997922014696:web:53a2b551fc88b6651ed05d",
  measurementId: "G-XPQQH7W14W"
};

  // Initialise Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // üîÅ Auth state (utile pour afficher les bonnes pages)
  onAuthStateChanged(auth, user => {
    if (user) {
      console.log("Connect√© :", user.email);
      // Rediriger ou charger contenu priv√©
    } else {
      console.log("Utilisateur d√©connect√©");
      // Rediriger vers page login
    }
  });

  // üîê Fonctions de connexion / inscription
  window.signIn = async function(email, password) {
    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("Connect√© !");
    } catch (error) {
      alert("Erreur de connexion : " + error.message);
    }
  }

  window.signUp = async function(email, password) {
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("Compte cr√©√© !");
    } catch (error) {
      alert("Erreur d'inscription : " + error.message);
    }
  }

  window.logout = async function() {
    await signOut(auth);
    alert("D√©connect√© !");
  }

  // üîÑ Exemple d'acc√®s √† la base Firestore
  window.getProgression = async function() {
    const user = auth.currentUser;
    if (!user) return;
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      const data = snap.data();
      console.log("Progression :", data.progress);
    } else {
      await setDoc(ref, { progress: 0, coins: 0 });
      console.log("Profil initialis√©");
    }
  }

  window.setProgression = async function(level, coins) {
    const user = auth.currentUser;
    if (!user) return;
    const ref = doc(db, "users", user.uid);
    await updateDoc(ref, { progress: level, coins: coins });
  }
</script>
<body>
  <h2>Connexion</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <button onclick="signIn(email.value, password.value)">Se connecter</button>
  <button onclick="signUp(email.value, password.value)">Cr√©er un compte</button>
  <button onclick="logout()">Se d√©connecter</button>
  <button onclick="getProgression()">Afficher ma progression</button>
  <button onclick="setProgression(2, 100)">D√©finir niveau 2, 100 pi√®ces</button>
</body>
</html>
